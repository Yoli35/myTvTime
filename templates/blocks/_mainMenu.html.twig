{% set user = app.user %}
{% set route = app.request.attributes.get('_route') %}
{% set parameters = app.request.query %}
{% set route_params = app.request.attributes.get('_route_params') %}

<nav class="nav-menu">
    <a href="{{ path('app_home') }}">{{ 'Home'|trans }}</a>
    <a href="{{ path('app_blog') }}">{{ 'Blog'|trans }}</a>
    <a href="{{ path('app_movie_list') }}">{{ 'Movies'|trans }}</a>
    <a href="{{ path('app_serie_popular') }}">{{ 'Popular Series'|trans }}</a>
    <a href="{{ path('app_serie_top_rated') }}">{{ 'Top rated Series'|trans }}</a>
    <a href="{{ path('app_serie_airing_today') }}">{{ 'Series Airing Today'|trans }}</a>
    <a href="{{ path('app_serie_on_the_air') }}">{{ 'Series On The Air'|trans }}</a>
    <a href="{{ path('app_serie_search') }}">{{ 'Series search'|trans }}</a>
    <hr class="divider">
    {% if user is null %}
        <a href="{{ path('app_register') }}">{{ 'Register'|trans }}</a>
        <a href="{{ path('app_login') }}">{{ 'Connexion'|trans }}</a>
    {% else %}
        <span class="welcome">
            {{ 'Welcome'|trans }}&nbsp;{{ user.username }}&nbsp;!
            {% if user.avatar is defined and  user.avatar|length %}
                <img class="avatar" src="/images/users/avatars/{{ user.avatar }}" alt="{{ user.username }}">
            {% endif %}
        </span>
        <a href="{{ path('app_personal_profile') }}">{{ 'My Account'|trans }}</a>
        <a href="{{ path('app_event') }}">{{ 'My Events'|trans }}</a>
        <a href="{{ path('app_personal_movies') }}">{{ 'My Movies'|trans }}</a>
        <a href="{{ path('app_collection') }}">{{ 'My Movie Collections'|trans }}</a>
        <a href="{{ path('app_serie_index') }}">{{ 'My Series'|trans }}</a>
        <a href="{{ path('app_youtube') }}">{{ 'My Youtube Videos'|trans }}</a>
        <a href="{{ path('app_youtube_search') }}">{{ 'Youtube video search'|trans }}</a>
        <a href="{{ path('app_tik_tok') }}">{{ 'My TikTok Videos'|trans }}</a>
        <hr class="divider">
        <div class="locale">
            {% set p = '' %}
            {% if parameters|length %}
                {% for key, value in parameters %}
                    {% set p = p ~ (loop.index0 ? '&':'?') ~ key ~ '=' ~ value %}
                {% endfor %}
            {% endif %}
            <a href="{{ path(route, route_params|merge({'_locale': 'fr'})) ~ p }}"><img src="/images/interface/fr.png" alt="{{ 'French'|trans }}"></a>
            <a href="{{ path(route, route_params|merge({'_locale': 'en'})) ~ p }}"><img src="/images/interface/en.png" alt="{{ 'English'|trans }}"></a>
            <a href="{{ path(route, route_params|merge({'_locale': 'de'})) ~ p }}"><img src="/images/interface/de.png" alt="{{ 'German'|trans }}"></a>
            <a href="{{ path(route, route_params|merge({'_locale': 'es'})) ~ p }}"><img src="/images/interface/es.png" alt="{{ 'Spanish'|trans }}"></a>
        </div>
        <hr class="divider">
        <a href="{{ path('app_rgpd') }}">{{ 'Confidentiality policy'|trans }}</a>

        {% if is_granted('ROLE_ADMIN') %}
            <hr class="divider">
            <a href="{{ path('app_admin_dashboard_index') }}">{{ 'Another action'|trans }}</a>
            <a href="{{ path('app_php_info') }}">{{ 'Php Info'|trans }}</a>
        {% endif %}

        <hr class="divider">
        <a href="{{ path('app_logout') }}">{{ 'Logout'|trans }}</a>
    {% endif %}
    <hr class="divider">
    <a href="mailto:contact@mytvtime.fr"><i class="fa-solid fa-envelope-open-text"></i> Contact</a>
</nav>
<button type="button" aria-label="toggle curtain navigation" class="nav-toggler">
    <span class="line l1"></span>
    <span class="line l2"></span>
    <span class="line l3"></span>
</button>
<script>
    const hamburgerButton = document.querySelector('.nav-toggler');
    const navigation = document.querySelector('nav');

    hamburgerButton.addEventListener("click", toggleNav);
    document.addEventListener("click", closeNav);

    function toggleNav(evt) {
        evt.stopPropagation();
        hamburgerButton.classList.toggle("active");
        navigation.classList.toggle("active");
    }

    function closeNav(evt) {
        if (hamburgerButton.classList.contains("active")) {
            if (!navigation.contains(evt.target)) {
                evt.preventDefault();
            }
            hamburgerButton.classList.remove("active");
            navigation.classList.remove("active");
        }
    }
</script>

{% for message in app.flashes('success') %}
    <div class="alert alert-success" role="alert">
        {{ message|trans }}
    </div>
{% endfor %}