{% extends 'base.html.twig' %}
{% block title %}myTvTime ▶ ︎{{ 'Home'|trans }}{% endblock %}

{% block body %}
    <div class="container">

        {{ include('blocks/_mainMenu.html.twig') }}

        <div class="home-header">
            {{ include('blocks/_clock.html.twig') }}
        </div>

        {{ include('blocks/_nav.html.twig', {thisPage: 'Home'|trans, user: app.user}) }}
        {{ include('blocks/source/_button.html.twig') }}

        {% for list in lists %}
            {% if list.data %}
                <h2>{{ list.name|trans }}</h2>
                <div class="home-list">
                    <div class="wrapper">
                        {% for item in list.data %}
                            {% if list.type=='movie' %}
                                {% set poster = imageConfig.url ~ imageConfig.poster_sizes.3 ~ item.posterPath %}
                                {{ include('blocks/movie/_discover.html.twig', { title: item.title, poster: poster, id: item.movieDbId }) }}
                            {% endif %}
                            {% if list.type=='serie' %}
                                {{ include('blocks/serie/_card-home.html.twig', {type: 'show', serie: item, poster_path: item.posterPath}) }}
                            {% endif %}
                            {% if list.type=='sql serie' %}
                                {{ include('blocks/serie/_card-home.html.twig', {type: 'show', serie: item, poster_path: item.poster_path}) }}
                            {% endif %}
                            {% if list.type=='people' %}
                                {% if item.profile_path %}
                                    {{ include('blocks/people/_card-home.html.twig', {people: item}) }}
                                {% endif %}
                            {% endif %}
                            {% if list.type=='tmdb movie' %}
                                {% set poster = imageConfig.url ~ imageConfig.poster_sizes.3 ~ item.poster_path %}
                                {{ include('blocks/movie/_discover.html.twig', { title: item.title, poster: poster, id: item.id }) }}
                            {% endif %}
                            {% if list.type=='tmdb serie' %}
                                {{ include('blocks/serie/_card-home.html.twig', {type: 'tmdb', serie: item, poster_path: item.poster_path}) }}
                            {% endif %}
                            {% if list.type=='tmdb mixte' %}
                                {% if item.media_type == 'movie' %}
                                    {% set poster = imageConfig.url ~ imageConfig.poster_sizes.3 ~ item.poster_path %}
                                    {{ include('blocks/movie/_discover.html.twig', { title: item.title, poster: poster, id: item.id }) }}
                                {% endif %}
                                {% if item.media_type == 'tv' %}
                                    {{ include('blocks/serie/_card-home.html.twig', {type: 'tmdb', serie: item, poster_path: item.poster_path}) }}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}

        {{ include('blocks/_pageFooter.html.twig') }}

    </div>

    {{ show_source_code(_self) }}
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="/js/source.js"></script>
    <script>
        let posters = [];
        window.addEventListener("DOMContentLoaded", () => {
            const container = document.querySelector(".container");
            if (container.clientWidth < 1200) {
                return;
            }
            const header = document.querySelector(".home-header");
            const div = document.createElement("div");

            div.classList.add("posters");
            header.appendChild(div);
            getPosters(div);
        });

        function getPosters(div) {
            const xhr = new XMLHttpRequest();
            xhr.onload = function () {
                let data = JSON.parse(this.response);
                console.log({data});
                posters = data;
                cyclePosters(div);
            }
            xhr.open("GET", '/get-posters');
            xhr.send();
        }

        function cyclePosters(div) {
            let i = 0;
            const img = document.createElement("img");
            img.src = posters[i++];
            div.appendChild(img);
            setTimeout(() => {
                img.classList.add("end");
            }, 0);

            setInterval(() => {
                const newImg = document.createElement("img");
                const oldImg = div.querySelector("img");

                newImg.src = posters[i++];
                if (oldImg) div.removeChild(oldImg);
                div.appendChild(newImg);
                setTimeout(() => {
                    newImg.classList.add("end");
                }, 0);
                if (i >= posters.length) {
                    i = 0;
                }
            }, 5000);
        }
    </script>
{% endblock %}
